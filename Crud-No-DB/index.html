<!DOCTYPE html>
<html>
<head>
    <title>Go CRUD App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Go CRUD App (HTML + CSS + Fetch)</h1>

    <div>
        <input id="itemName" placeholder="Enter item name" />
        <button onclick="createItem()">Add Item</button>
    </div>

    <div>
        <input id="getId" placeholder="Enter ID to Get" />
        <button onclick="getItemById()">Get Item</button>
    </div>

    <div>
        <input id="updateId" placeholder="Enter ID to Update" />
        <input id="updateName" placeholder="New Name" />
        <button onclick="updateItemById()">Update Item</button>
    </div>

    <h3>Items List:</h3>
    <ul id="itemList"></ul>

    <script>
        async function fetchItems() {
            const res = await fetch("/items");
            const data = await res.json();

            const list = document.getElementById("itemList");
            list.innerHTML = "";

            Object.entries(data).forEach(([id, name]) => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <strong>ID:</strong> ${id} | 
                    <strong>Name:</strong> ${name} 
                    <button onclick="deleteItem(${id})">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        async function createItem() {
            const name = document.getElementById("itemName").value;
            if (!name) return alert("Name is required");
            await fetch("/items", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name })
            });
            document.getElementById("itemName").value = "";
            fetchItems();
        }

        async function deleteItem(id) {
            await fetch(`/items/${id}`, { method: "DELETE" });
            fetchItems();
        }

        async function getItemById() {
            const id = document.getElementById("getId").value;
            if (!id) return alert("Enter an ID");
            const res = await fetch(`/items/${id}`);
            if (res.status === 404) return alert("Item not found");
            const data = await res.json();
            alert(`Item: ${data.name}`);
        }

        async function updateItemById() {
            const id = document.getElementById("updateId").value;
            const name = document.getElementById("updateName").value;
            if (!id || !name) return alert("Both ID and new name are required");

            const res = await fetch(`/items/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name })
            });

            if (res.status === 404) {
                alert("Item not found");
            } else {
                alert("Item updated");
                fetchItems();
            }
        }

        // Initial load
        fetchItems();
    </script>
</body>
</html>
